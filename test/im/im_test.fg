####### test_sync.fg

# to run, launch server and two clients, 'client1' and 'client2'

import '../mesh'
import '../test_director'
import 'im' # for port


director = [

    'run_tests' : function(self)

        self.login()
        # self.presence()
        # self.chat()

    end,

    'after_tests' : function(self)
        self.im_direct('client1', 'forget')
        self.im_direct('client2', 'forget')
    end,

    #
    # test login, presence, chat
    #

    'login' : function(self)

        self.test_title('login')

        self.im_direct('client1', 'signup', 'client1', 'a')
        self.im_direct('client1', 'signout', 'client1')
        self.im_direct('client1', 'signin', 'client1', 'a')

        self.im_direct('client2', 'signup', 'client2', 'z')
        self.im_direct('client2', 'signout', 'client2')
        self.im_direct('client2', 'signin', 'client2', 'z')

    end,

    'presence' : function(self)
        self.im_direct('client1', 'presence', 'who':'client2', 'online':true)
        self.im_direct('client1', 'signout', 'client2')
        self.im_direct('client1', 'presence', 'who':'client2', 'online':false)
        self.im_direct('client1', 'signin', 'client2', 'z')
    end,

    'im_direct' : function(self, whom, action, id, pw)

        title = action +' '+ id +','+ pw
        self.direct(title, whom, action, ['id':id, 'password':pw])

    end,


] + test_director

sys.print('test port ' + port)
mesh = Mesh.init(director.id, port, [director])
director.launch(mesh, '../../source/filagree', 'im_server.fg', 2, 'im_client.fg')
